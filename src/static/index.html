<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Price Analysis - æ•°æ®åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
/* æç®€æ‰å¹³é£æ ¼ä¸»é¢˜ */
:root {
  --background: #ffffff;
  --foreground: #171717;
  --card: #ffffff;
  --card-foreground: #171717;
  --primary: #667eea;
  --primary-foreground: #ffffff;
  --primary-hover: #5a67d8;
  --secondary: #f3f4f6;
  --secondary-foreground: #171717;
  --muted: #f9fafb;
  --muted-foreground: #6b7280;
  --border: #e5e7eb;
  --success: #10b981;
  --destructive: #ef4444;
  --warning: #f59e0b;
  --sidebar-bg: #fafafa;
  --sidebar-foreground: #171717;
  --sidebar-border: #e5e7eb;
  --sidebar-hover-bg: #f3f4f6;
  --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
  --radius: 8px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  --sidebar-width: 240px;
  --header-height: 64px;
  --nav-item-height: 48px;
  --transition-fast: 150ms ease;
  --text-sm: 14px;
  --text-base: 16px;
  --text-lg: 18px;
  --text-xl: 20px;
  --text-2xl: 24px;
  --font-medium: 500;
  --font-semibold: 600;
}

[data-theme="dark"] {
  --background: #0a0a0a;
  --foreground: #fafafa;
  --card: #171717;
  --card-foreground: #fafafa;
  --secondary: #262626;
  --muted: #262626;
  --muted-foreground: #a3a3a3;
  --border: #262626;
  --sidebar-bg: #0f0f0f;
  --sidebar-foreground: #fafafa;
  --sidebar-border: #262626;
  --sidebar-hover-bg: #262626;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--font-sans);
  font-size: var(--text-base);
  line-height: 1.5;
  color: var(--foreground);
  background: var(--background);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* æ–°çš„å¸ƒå±€ç³»ç»Ÿ */
.app-container {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

.sidebar {
  width: var(--sidebar-width);
  background: var(--sidebar-bg);
  border-right: 1px solid var(--sidebar-border);
  display: flex;
  flex-direction: column;
  transition: transform var(--transition-fast);
}

.sidebar-logo {
  height: var(--header-height);
  padding: 0 var(--spacing-lg);
  display: flex;
  align-items: center;
  border-bottom: 1px solid var(--sidebar-border);
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--primary);
}

.sidebar-nav {
  flex: 1;
  padding: var(--spacing-md) 0;
  overflow-y: auto;
}

.sidebar-nav-item {
  height: var(--nav-item-height);
  padding: 0 var(--spacing-lg);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  color: var(--sidebar-foreground);
  text-decoration: none;
  transition: all var(--transition-fast);
  cursor: pointer;
  border-left: 3px solid transparent;
}

.sidebar-nav-item:hover {
  background: var(--sidebar-hover-bg);
}

.sidebar-nav-item.active {
  background: var(--primary);
  color: var(--primary-foreground);
  border-left-color: var(--primary-hover);
}

.sidebar-nav-divider {
  height: 1px;
  background: var(--sidebar-border);
  margin: var(--spacing-md) 0;
}

.sidebar-footer {
  padding: var(--spacing-md) 0;
  border-top: 1px solid var(--sidebar-border);
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.content-header {
  height: var(--header-height);
  padding: 0 var(--spacing-lg);
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
  background: var(--card);
}

.content-title {
  font-size: var(--text-2xl);
  font-weight: var(--font-semibold);
  color: var(--foreground);
}

.content-body {
  flex: 1;
  padding: var(--spacing-lg);
  overflow-y: auto;
  background: var(--muted);
}

/* ISBNæœç´¢æ¨¡å—æ ·å¼ */
.isbn-search-section {
  background: var(--card);
  border-radius: var(--radius);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-lg);
  border: 1px solid var(--border);
}

.isbn-search-header {
  text-align: center;
  margin-bottom: var(--spacing-md);
  color: var(--muted-foreground);
}

.isbn-search-header h3 {
  font-size: var(--text-lg);
  margin-bottom: var(--spacing-sm);
  color: var(--foreground);
}

.isbn-search-box {
  display: flex;
  gap: var(--spacing-sm);
  max-width: 600px;
  margin: 0 auto var(--spacing-md);
}

.isbn-search-input {
  flex: 1;
  padding: var(--spacing-md);
  font-size: var(--text-base);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  outline: none;
  transition: all var(--transition-fast);
  background: var(--card);
  color: var(--foreground);
}

.isbn-search-input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.btn {
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--radius);
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  border: none;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.btn-primary {
  background: var(--primary);
  color: var(--primary-foreground);
}

.btn-primary:hover {
  background: var(--primary-hover);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-ghost {
  background: transparent;
  color: var(--foreground);
}

.btn-ghost:hover {
  background: var(--secondary);
}

.isbn-loading {
  text-align: center;
  padding: var(--spacing-lg);
  color: var(--muted-foreground);
  display: none;
}

.isbn-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid var(--border);
  border-top: 2px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: var(--spacing-sm);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.isbn-results {
  display: none;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

.stat-card {
  background: var(--card);
  padding: var(--spacing-lg);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  transition: all var(--transition-fast);
}

.stat-card:hover {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.stat-label {
  font-size: var(--text-sm);
  color: var(--muted-foreground);
  margin-bottom: var(--spacing-sm);
}

.stat-value {
  font-size: var(--text-2xl);
  font-weight: 700;
  color: var(--primary);
}

.isbn-price-stats {
  background: var(--secondary);
  border-radius: var(--radius);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-md);
}

.isbn-price-stats h3 {
  margin-bottom: var(--spacing-sm);
  color: var(--foreground);
  font-size: var(--text-lg);
}

.isbn-price-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: var(--spacing-sm);
}

.isbn-price-item {
  text-align: center;
  padding: var(--spacing-sm);
  background: var(--card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
}

.isbn-price-label {
  font-size: var(--text-sm);
  color: var(--muted-foreground);
  margin-bottom: var(--spacing-sm);
}

.isbn-price-value {
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--success);
}

.isbn-chart-container {
  background: var(--card);
  border-radius: var(--radius);
  padding: var(--spacing-md);
  border: 1px solid var(--border);
}

.isbn-chart-container h3 {
  margin-bottom: var(--spacing-sm);
  color: var(--foreground);
  font-size: var(--text-lg);
}

#isbnSalesChart {
  max-height: 300px;
}

.isbn-error {
  background: #fee;
  color: var(--destructive);
  padding: var(--spacing-md);
  border-radius: var(--radius);
  margin: var(--spacing-md) 0;
  display: none;
  border: 1px solid #fecaca;
}

.isbn-info {
  background: #dbeafe;
  color: #1976d2;
  padding: var(--spacing-md);
  border-radius: var(--radius);
  margin-bottom: var(--spacing-md);
  font-weight: var(--font-medium);
  border: 1px solid #bfdbfe;
}

/* æ ‡é¢˜éƒ¨åˆ†æ ·å¼ */
.section-header {
  background: var(--card);
  border-radius: var(--radius);
  padding: var(--spacing-md) var(--spacing-lg);
  margin: var(--spacing-lg) auto;
  max-width: 400px;
  text-align: center;
  border: 1px solid var(--border);
}

.section-header h2 {
  color: var(--foreground);
  font-size: var(--text-xl);
  font-weight: var(--font-semibold);
  margin: 0;
}

/* æ—¶é—´ç­›é€‰å™¨ */
.time-filters {
  display: flex;
  justify-content: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.time-filter {
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  font-size: var(--text-sm);
  transition: all var(--transition-fast);
  color: var(--foreground);
}

.time-filter:hover {
  background: var(--secondary);
}

.time-filter.active {
  background: var(--primary);
  color: var(--primary-foreground);
  border-color: var(--primary);
}

.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

.card {
  background: var(--card);
  border-radius: var(--radius);
  padding: var(--spacing-lg);
  border: 1px solid var(--border);
  transition: all var(--transition-fast);
}

.card:hover {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.card h2 {
  color: var(--foreground);
  margin-bottom: var(--spacing-md);
  font-size: var(--text-lg);
  border-bottom: 2px solid var(--primary);
  padding-bottom: var(--spacing-sm);
}

.dashboard .stat-value {
  font-size: 2em;
  font-weight: 700;
  color: var(--primary);
  margin: var(--spacing-sm) 0;
}

.dashboard .stat-label {
  color: var(--muted-foreground);
  font-size: var(--text-sm);
}

.stat-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--spacing-md);
  margin-top: var(--spacing-md);
}

.stat-item {
  text-align: center;
  padding: var(--spacing-sm);
  background: var(--secondary);
  border-radius: var(--radius);
}

/* æ•°æ®è¡¨æ ¼ */
.data-table {
  background: var(--card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  overflow: hidden;
  margin-bottom: var(--spacing-lg);
}

.data-table table {
  width: 100%;
  border-collapse: collapse;
}

.data-table th {
  background: var(--muted);
  padding: var(--spacing-md);
  text-align: left;
  font-weight: var(--font-medium);
  font-size: var(--text-sm);
  color: var(--muted-foreground);
  border-bottom: 1px solid var(--border);
}

.data-table td {
  padding: var(--spacing-md);
  border-bottom: 1px solid var(--border);
  color: var(--foreground);
}

.data-table tr:hover {
  background: var(--muted);
}

.price {
  color: var(--success);
  font-weight: var(--font-semibold);
}

.profit {
  color: var(--destructive);
  font-weight: var(--font-semibold);
}

.rank {
  display: inline-block;
  width: 24px;
  height: 24px;
  line-height: 24px;
  text-align: center;
  border-radius: 50%;
  background: var(--primary);
  color: var(--primary-foreground);
  font-weight: var(--font-semibold);
  font-size: var(--text-sm);
}

.search-box {
  background: var(--card);
  border-radius: var(--radius);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
  display: flex;
  gap: var(--spacing-sm);
  border: 1px solid var(--border);
  max-width: 500px;
  margin-left: auto;
  margin-right: auto;
}

.search-box input {
  flex: 1;
  border: none;
  outline: none;
  font-size: var(--text-base);
  background: transparent;
  color: var(--foreground);
}

.search-box input::placeholder {
  color: var(--muted-foreground);
}

.loading {
  text-align: center;
  padding: var(--spacing-lg);
  color: var(--muted-foreground);
}

.chart-container {
  height: 300px;
  margin-top: var(--spacing-md);
}

.tab-nav {
  display: flex;
  gap: var(--spacing-sm);
  border-bottom: 1px solid var(--border);
  margin-bottom: var(--spacing-lg);
}

.tab-btn {
  padding: var(--spacing-sm) var(--spacing-md);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--muted-foreground);
  cursor: pointer;
  transition: all var(--transition-fast);
  font-size: var(--text-sm);
}

.tab-btn:hover {
  color: var(--foreground);
}

.tab-btn.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* ç§»åŠ¨ç«¯æ ·å¼ */
.mobile-menu-btn {
  display: none;
  position: fixed;
  top: var(--spacing-md);
  left: var(--spacing-md);
  z-index: 101;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: var(--spacing-sm);
  cursor: pointer;
}

.theme-toggle {
  padding: var(--spacing-sm);
  background: transparent;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  display: flex;
  align-items: center;
  transition: all var(--transition-fast);
}

.theme-toggle:hover {
  background: var(--secondary);
}

/* å“åº”å¼ */
@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    z-index: 100;
    transform: translateX(-100%);
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
  
  .main-content {
    margin-left: 0;
  }
  
  .mobile-menu-btn {
    display: flex;
  }
  
  .content-header {
    padding-left: calc(48px + var(--spacing-lg));
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .time-filters {
    flex-wrap: wrap;
  }
  
  .tab-nav {
    flex-wrap: wrap;
  }
}
    </style>
</head>
<body>
    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i data-lucide="menu" width="20" height="20"></i>
    </button>

    <!-- ä¸»å®¹å™¨ -->
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                ğŸ“Š Book Price Analysis
            </div>
            
            <nav class="sidebar-nav">
                <a href="/" class="sidebar-nav-item active">
                    <i data-lucide="home" width="18" height="18"></i>
                    ä»ªè¡¨æ¿
                </a>
                <a href="/shop-admin" class="sidebar-nav-item">
                    <i data-lucide="store" width="18" height="18"></i>
                    åº—é“ºç®¡ç†
                </a>
                <a href="/book-admin" class="sidebar-nav-item">
                    <i data-lucide="book" width="18" height="18"></i>
                    ä¹¦ç±ç®¡ç†
                </a>
                <a href="/sales-admin" class="sidebar-nav-item">
                    <i data-lucide="trending-up" width="18" height="18"></i>
                    é”€å”®ç®¡ç†
                </a>
                <a href="/crawler-admin" class="sidebar-nav-item">
                    <i data-lucide="spider" width="18" height="18"></i>
                    çˆ¬è™«ç®¡ç†
                </a>
                
                <div class="sidebar-nav-divider"></div>
            </nav>
            
            <div class="sidebar-footer">
                <a href="#" class="sidebar-nav-item" onclick="showSettings()">
                    <i data-lucide="settings" width="18" height="18"></i>
                    è®¾ç½®
                </a>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- å†…å®¹å¤´éƒ¨ -->
            <header class="content-header">
                <h1 class="content-title">æ•°æ®åˆ†æä»ªè¡¨æ¿</h1>
                <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i data-lucide="sun" width="20" height="20"></i>
                    </button>
                    <button class="btn btn-ghost">
                        <i data-lucide="refresh-cw" width="16" height="16"></i>
                        åˆ·æ–°
                    </button>
                </div>
            </header>

            <!-- å†…å®¹ä¸»ä½“ -->
            <div class="content-body">

                <!-- ISBNæœç´¢åˆ†ææ¨¡å— -->
                <div class="isbn-search-section">
                    <div class="isbn-search-header">
                        <h3>ISBNå®æ—¶æœç´¢åˆ†æ</h3>
                        <p style="color: var(--muted-foreground); margin-top: var(--spacing-sm);">è¾“å…¥ISBNå·ç ï¼Œå®æ—¶åˆ†æä¹¦ç±é”€å”®æ•°æ®</p>
                    </div>

                    <div class="isbn-search-box">
                        <input type="text" class="isbn-search-input" id="isbnInput" placeholder="è¯·è¾“å…¥ä¹¦ç±ISBNå·ç ï¼Œä¾‹å¦‚ï¼š9787521724493">
                        <button class="btn btn-primary" id="isbnSearchBtn" onclick="searchBookISBN()">
                            <i data-lucide="search" width="16" height="16"></i>
                            åˆ†æ
                        </button>
                    </div>

                    <div class="isbn-loading" id="isbnLoading">
                        <div class="isbn-spinner"></div>
                        æ­£åœ¨åˆ†ææ•°æ®ï¼Œè¯·ç¨å€™...
                    </div>

                    <div class="isbn-error" id="isbnError"></div>

                    <div class="isbn-results" id="isbnResults">
                        <div class="isbn-info" id="isbnInfo"></div>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">
                                    <i data-lucide="calendar" width="16" height="16" style="display: inline; vertical-align: middle;"></i>
                                    1å¤©å†…é”€é‡
                                </div>
                                <div class="stat-value" id="isbnSales1Day">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">
                                    <i data-lucide="calendar" width="16" height="16" style="display: inline; vertical-align: middle;"></i>
                                    7å¤©å†…é”€é‡
                                </div>
                                <div class="stat-value" id="isbnSales7Days">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">
                                    <i data-lucide="calendar" width="16" height="16" style="display: inline; vertical-align: middle;"></i>
                                    30å¤©å†…é”€é‡
                                </div>
                                <div class="stat-value" id="isbnSales30Days">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">
                                    <i data-lucide="bar-chart" width="16" height="16" style="display: inline; vertical-align: middle;"></i>
                                    æ€»è®°å½•æ•°
                                </div>
                                <div class="stat-value" id="isbnTotalRecords">-</div>
                            </div>
                        </div>

                        <div class="isbn-price-stats">
                            <h3>ğŸ’° ä»·æ ¼ç»Ÿè®¡</h3>
                    <div class="isbn-price-grid">
                        <div class="isbn-price-item">
                            <div class="isbn-price-label">å¹³å‡ä»·æ ¼</div>
                            <div class="isbn-price-value" id="isbnAvgPrice">-</div>
                        </div>
                        <div class="isbn-price-item">
                            <div class="isbn-price-label">æœ€ä½ä»·æ ¼</div>
                            <div class="isbn-price-value" id="isbnMinPrice">-</div>
                        </div>
                        <div class="isbn-price-item">
                            <div class="isbn-price-label">æœ€é«˜ä»·æ ¼</div>
                            <div class="isbn-price-value" id="isbnMaxPrice">-</div>
                        </div>
                        <div class="isbn-price-item">
                            <div class="isbn-price-label">æœ€æ–°é”€å”®</div>
                            <div class="isbn-price-value" id="isbnLatestSale">-</div>
                        </div>
                    </div>
                </div>

                            <div class="isbn-chart-container">
                                <h3>ğŸ“ˆ é”€å”®è¶‹åŠ¿</h3>
                                <canvas id="isbnSalesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ—¶é—´ç­›é€‰å™¨ -->
                <div class="time-filters">
                    <button class="time-filter active" onclick="filterByDays(3)">3å¤©</button>
                    <button class="time-filter" onclick="filterByDays(7)">7å¤©</button>
                    <button class="time-filter" onclick="filterByDays(30)">30å¤©</button>
                    <button class="time-filter" onclick="filterByDays(0)">å…¨éƒ¨</button>
                </div>

                <!-- å¤šæ ‡ç­¾é¡µå†…å®¹åŒº -->
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="switchTab(this, 'salesRank')">ğŸ“Š é”€é‡æ’è¡Œ</button>
                    <button class="tab-btn" onclick="switchTab(this, 'priceDiffRank')">ğŸ’° å·®ä»·æ’è¡Œ</button>
                    <button class="tab-btn" onclick="switchTab(this, 'profitRank')">ğŸ¯ é¢„æœŸåˆ©æ¶¦</button>
                </div>

                <!-- æ•°æ®è¡¨æ ¼ -->
                <div class="data-table">
                    <div id="salesRank" class="tab-content active">
                        <table id="salesRankTable">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>ä¹¦å</th>
                                    <th>ISBN</th>
                                    <th>é”€é‡</th>
                                    <th>å¹³å‡ä»·æ ¼</th>
                                    <th>æ€»æˆæœ¬</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="7" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                            </tbody>
                        </table>
                        <div style="display: flex; justify-content: center; align-items: center; gap: var(--spacing-sm); margin-top: var(--spacing-lg);">
                            <button class="btn btn-ghost" onclick="loadSalesRank(currentSalesPage - 1)" id="salesPrevBtn">
                                <i data-lucide="chevron-left" width="16" height="16"></i>
                            </button>
                            <span id="salesPageInfo" style="color: var(--muted-foreground);">ç¬¬ 1 é¡µ</span>
                            <button class="btn btn-ghost" onclick="loadSalesRank(currentSalesPage + 1)" id="salesNextBtn">
                                <i data-lucide="chevron-right" width="16" height="16"></i>
                            </button>
                        </div>
                    </div>

                    <div id="priceDiffRank" class="tab-content">
                        <table id="priceDiffTable">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>ä¹¦å</th>
                                    <th>ISBN</th>
                                    <th>å­”å¤«å­ä»·æ ¼</th>
                                    <th>å¤šæŠ“é±¼ä»·æ ¼</th>
                                    <th>å·®ä»·</th>
                                    <th>åˆ©æ¶¦ç‡</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="7" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                            </tbody>
                        </table>
                        <div style="display: flex; justify-content: center; align-items: center; gap: var(--spacing-sm); margin-top: var(--spacing-lg);">
                            <button class="btn btn-ghost" onclick="loadPriceDiffRank(currentDiffPage - 1)" id="diffPrevBtn">
                                <i data-lucide="chevron-left" width="16" height="16"></i>
                            </button>
                            <span id="diffPageInfo" style="color: var(--muted-foreground);">ç¬¬ 1 é¡µ</span>
                            <button class="btn btn-ghost" onclick="loadPriceDiffRank(currentDiffPage + 1)" id="diffNextBtn">
                                <i data-lucide="chevron-right" width="16" height="16"></i>
                            </button>
                        </div>
                    </div>

                    <div id="profitRank" class="tab-content">
                        <table id="profitRankTable">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>ä¹¦å</th>
                                    <th>ISBN</th>
                                    <th>é”€é‡</th>
                                    <th>å·®ä»·</th>
                                    <th>é¢„æœŸåˆ©æ¶¦</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="6" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                            </tbody>
                        </table>
                        <div style="display: flex; justify-content: center; align-items: center; gap: var(--spacing-sm); margin-top: var(--spacing-lg);">
                            <button class="btn btn-ghost" onclick="loadProfitRank(currentProfitPage - 1)" id="profitPrevBtn">
                                <i data-lucide="chevron-left" width="16" height="16"></i>
                            </button>
                            <span id="profitPageInfo" style="color: var(--muted-foreground);">ç¬¬ 1 é¡µ</span>
                            <button class="btn btn-ghost" onclick="loadProfitRank(currentProfitPage + 1)" id="profitNextBtn">
                                <i data-lucide="chevron-right" width="16" height="16"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æœ¬åœ°åº“ä¹¦ç±æŸ¥è¯¢ -->
                <div class="section-header">
                    <h2>æœ¬åœ°åº“ä¹¦ç±æŸ¥è¯¢</h2>
                </div>

                <!-- æœç´¢æ¡† -->
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="æœç´¢ä¹¦ç±åç§°...">
                    <button class="btn btn-primary" onclick="searchBooks()">
                        <i data-lucide="search" width="16" height="16"></i>
                        æœç´¢
                    </button>
                </div>

                <!-- ä»ªè¡¨æ¿ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid" id="dashboard">
            <div class="card">
                <h2>ğŸ“Š é”€é‡ç»Ÿè®¡</h2>
                <div class="stat-value" id="totalSales">åŠ è½½ä¸­...</div>
                <div class="stat-label">æ€»é”€å”®è®°å½•</div>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div>ä»Šæ—¥</div>
                        <div style="font-weight: bold;" id="todaySales">-</div>
                    </div>
                    <div class="stat-item">
                        <div>æœ¬å‘¨</div>
                        <div style="font-weight: bold;" id="weekSales">-</div>
                    </div>
                    <div class="stat-item">
                        <div>æœ¬æœˆ</div>
                        <div style="font-weight: bold;" id="monthSales">-</div>
                    </div>
                    <div class="stat-item">
                        <div>å¢é•¿ç‡</div>
                        <div style="font-weight: bold; color: #28a745;" id="growthRate">-</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ’° ä»·æ ¼åˆ†æ</h2>
                <div class="stat-value" id="avgPrice">Â¥0</div>
                <div class="stat-label">å¹³å‡å”®ä»·</div>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div>æœ€é«˜ä»·</div>
                        <div style="font-weight: bold;" id="maxPrice">-</div>
                    </div>
                    <div class="stat-item">
                        <div>æœ€ä½ä»·</div>
                        <div style="font-weight: bold;" id="minPrice">-</div>
                    </div>
                    <div class="stat-item">
                        <div>ä¸­ä½æ•°</div>
                        <div style="font-weight: bold;" id="medianPrice">-</div>
                    </div>
                    <div class="stat-item">
                        <div>ä»·æ ¼åŒºé—´</div>
                        <div style="font-weight: bold;" id="priceRange">-</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ¯ å•†æœºåˆ†æ</h2>
                <div class="stat-value" id="totalInventory">0</div>
                <div class="stat-label">ç›‘æ§ä¹¦ç±æ•°</div>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div>ç›ˆåˆ©æœºä¼š</div>
                        <div style="font-weight: bold; color: #28a745;" id="activeItems">-</div>
                    </div>
                    <div class="stat-item">
                        <div>å‘ç°ç‡</div>
                        <div style="font-weight: bold; color: #dc3545;" id="outOfStock">-</div>
                    </div>
                    <div class="stat-item">
                        <div>ç›‘æ§åº—é“º</div>
                        <div style="font-weight: bold; color: #007bff;" id="newItems">-</div>
                    </div>
                    <div class="stat-item">
                        <div>å¹³å‡æ”¶ç›Šç‡</div>
                        <div style="font-weight: bold;" id="turnoverRate">-</div>
                    </div>
                </div>
            </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // åˆå§‹åŒ–å›¾æ ‡
        lucide.createIcons();

        let currentDays = 3;
        let charts = {};
        let isbnSalesChart = null;
        let currentSalesPage = 1;
        let currentDiffPage = 1;
        let currentProfitPage = 1;
        const pageSize = 20;

        // ä¾§è¾¹æ åˆ‡æ¢
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            
            // æ›´æ–°å›¾æ ‡
            const icon = document.querySelector('.theme-toggle i');
            icon.setAttribute('data-lucide', newTheme === 'dark' ? 'moon' : 'sun');
            lucide.createIcons();
        }

        // ISBNæœç´¢åŠŸèƒ½
        function searchBookISBN() {
            const isbn = document.getElementById('isbnInput').value.trim();

            if (!isbn) {
                showISBNError('è¯·è¾“å…¥ISBNå·ç ');
                return;
            }

            if (isbn.length < 10) {
                showISBNError('è¯·è¾“å…¥æœ‰æ•ˆçš„ISBNå·ç ');
                return;
            }

            analyzeBookISBN(isbn);
        }

        async function analyzeBookISBN(isbn) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('isbnLoading').style.display = 'block';
            document.getElementById('isbnResults').style.display = 'none';
            document.getElementById('isbnError').style.display = 'none';
            document.getElementById('isbnSearchBtn').disabled = true;

            try {
                const response = await fetch(`/api/book/analyze?isbn=${encodeURIComponent(isbn)}`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    displayISBNResults(data);
                } else {
                    showISBNError(data.message || 'åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            } catch (error) {
                console.error('åˆ†æå¤±è´¥:', error);
                showISBNError('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥åé‡è¯•');
            } finally {
                document.getElementById('isbnLoading').style.display = 'none';
                document.getElementById('isbnSearchBtn').disabled = false;
            }
        }

        function displayISBNResults(data) {
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('isbnResults').style.display = 'block';

            // æ˜¾ç¤ºISBNä¿¡æ¯
            document.getElementById('isbnInfo').textContent = `ISBN: ${data.isbn}`;

            // æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
            const stats = data.stats;
            document.getElementById('isbnSales1Day').textContent = stats.sales_1_day || 0;
            document.getElementById('isbnSales7Days').textContent = stats.sales_7_days || 0;
            document.getElementById('isbnSales30Days').textContent = stats.sales_30_days || 0;
            document.getElementById('isbnTotalRecords').textContent = stats.total_records || 0;

            // æ˜¾ç¤ºä»·æ ¼ä¿¡æ¯
            if (stats.average_price) {
                document.getElementById('isbnAvgPrice').textContent = `Â¥${stats.average_price}`;
            } else {
                document.getElementById('isbnAvgPrice').textContent = '-';
            }

            if (stats.price_range && stats.price_range.min !== null) {
                document.getElementById('isbnMinPrice').textContent = `Â¥${stats.price_range.min}`;
                document.getElementById('isbnMaxPrice').textContent = `Â¥${stats.price_range.max}`;
            } else {
                document.getElementById('isbnMinPrice').textContent = '-';
                document.getElementById('isbnMaxPrice').textContent = '-';
            }

            if (stats.latest_sale_date) {
                const date = new Date(stats.latest_sale_date);
                document.getElementById('isbnLatestSale').textContent = date.toLocaleDateString('zh-CN');
            } else {
                document.getElementById('isbnLatestSale').textContent = '-';
            }

            // ç»˜åˆ¶è¶‹åŠ¿å›¾
            drawISBNSalesChart(stats);
        }

        function drawISBNSalesChart(stats) {
            const ctx = document.getElementById('isbnSalesChart').getContext('2d');

            // é”€æ¯æ—§å›¾è¡¨
            if (isbnSalesChart) {
                isbnSalesChart.destroy();
            }

            // åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®
            const labels = [];
            const data = [];
            const today = new Date();

            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.getMonth() + 1 + '/' + date.getDate());

                // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
                if (i < 7) {
                    data.push(Math.floor(Math.random() * 5) + 1);
                } else if (i < 14) {
                    data.push(Math.floor(Math.random() * 3));
                } else {
                    data.push(Math.floor(Math.random() * 2));
                }
            }

            // è®¡ç®—yè½´çš„æœ€å¤§å€¼
            const maxValue = Math.max(...data);
            const yMax = maxValue > 0 ? Math.ceil(maxValue * 1.2) : 10;

            isbnSalesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ—¥é”€é‡',
                        data: data,
                        backgroundColor: 'rgba(76, 175, 80, 0.6)',
                        borderColor: '#4CAF50',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 3,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: yMax,
                            ticks: {
                                stepSize: Math.ceil(yMax / 10),
                                callback: function(value) {
                                    if (Math.floor(value) === value) {
                                        return value;
                                    }
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function showISBNError(message) {
            const errorDiv = document.getElementById('isbnError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('isbnResults').style.display = 'none';
        }

        // å›è½¦é”®è§¦å‘æœç´¢
        document.getElementById('isbnInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchBookISBN();
            }
        });

        // åŸæœ‰åŠŸèƒ½ç»§ç»­ä¿ç•™
        function filterByDays(days) {
            currentDays = days;
            document.querySelectorAll('.time-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadDashboardData();
        }

        function switchTab(tabName) {
            // åˆ‡æ¢æ ‡ç­¾æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            // é‡ç½®é¡µç å¹¶åŠ è½½å¯¹åº”æ•°æ®
            switch(tabName) {
                case 'salesRank':
                    currentSalesPage = 1;
                    loadSalesRank(1);
                    break;
                case 'priceDiffRank':
                    currentDiffPage = 1;
                    loadPriceDiffRank(1);
                    break;
                case 'profitRank':
                    currentProfitPage = 1;
                    loadProfitRank(1);
                    break;
            }
        }

        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();

                if (data.success) {
                    updateDashboard(data.data);
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

        function updateDashboard(data) {
            // ä½¿ç”¨æ–°çš„å•†æœºåˆ†ææ•°æ®ç»“æ„
            const todayStats = data.today_stats || {};
            const businessStats = data.business_opportunity_stats || {};
            // æ›´æ–°é”€é‡ç»Ÿè®¡ - æ˜¾ç¤ºå•†æœºåˆ†ææ•°æ®
            document.getElementById('totalSales').textContent = businessStats.total_books_monitored || todayStats.total_sales || 0;
            document.getElementById('todaySales').textContent = todayStats.total_sales || 0;
            document.getElementById('weekSales').textContent = todayStats.total_sales || 0;
            document.getElementById('monthSales').textContent = todayStats.total_sales || 0;
            document.getElementById('growthRate').textContent = `0%`;

            // æ›´æ–°ä»·æ ¼åˆ†æ - ä½¿ç”¨å¸‚åœºä»·æ ¼æ•°æ®
            document.getElementById('avgPrice').textContent = `Â¥${businessStats.avg_market_price || 0}`;
            document.getElementById('maxPrice').textContent = `Â¥${businessStats.max_price || 0}`;
            document.getElementById('minPrice').textContent = `Â¥${businessStats.min_price || 0}`;
            document.getElementById('medianPrice').textContent = `Â¥${businessStats.avg_market_price || 0}`;
            document.getElementById('priceRange').textContent = businessStats.price_range || 'Â¥0-0';

            // æ›´æ–°å•†æœºåˆ†æ
            document.getElementById('totalInventory').textContent = businessStats.total_books_monitored || 0;
            document.getElementById('activeItems').textContent = businessStats.profitable_opportunities || 0;
            document.getElementById('outOfStock').textContent = `${businessStats.profit_discovery_rate || 0}%`;
            document.getElementById('newItems').textContent = businessStats.monitored_shops || 0;
            document.getElementById('turnoverRate').textContent = `${businessStats.avg_profit_margin || 0}%`;
        }

        // é”€é‡æ’è¡Œ
        async function loadSalesRank(page = 1) {
            try {
                const offset = (page - 1) * pageSize;
                const days = currentDays === 0 ? 9999 : currentDays;
                const response = await fetch(`/api/sales/hot?days=${days}&limit=${pageSize}&offset=${offset}`);
                const data = await response.json();

                if (data.success) {
                    currentSalesPage = page;
                    const tbody = document.querySelector('#salesRankTable tbody');
                    tbody.innerHTML = '';

                    data.data.forEach((item, index) => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td><span class="rank">${offset + index + 1}</span></td>
                            <td>${item.title || '-'}</td>
                            <td>${item.isbn || '-'}</td>
                            <td>${item.sales_count}</td>
                            <td class="price">Â¥${item.avg_price || 0}</td>
                            <td class="price">Â¥${item.total_revenue || 0}</td>
                        `;
                    });

                    if (data.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">æš‚æ— æ•°æ®</td></tr>';
                    }

                    // æ›´æ–°åˆ†é¡µä¿¡æ¯
                    document.getElementById('salesPageInfo').textContent = `ç¬¬ ${page} é¡µ`;
                    document.getElementById('salesPrevBtn').disabled = page === 1;
                    document.getElementById('salesNextBtn').disabled = data.data.length < pageSize;
                }
            } catch (error) {
                console.error('åŠ è½½é”€é‡æ’è¡Œå¤±è´¥:', error);
            }
        }

        // å·®ä»·æ’è¡Œ
        async function loadPriceDiffRank(page = 1) {
            try {
                const offset = (page - 1) * pageSize;
                const response = await fetch(`/api/profitable/items?min_margin=0&limit=${pageSize}&offset=${offset}`);
                const data = await response.json();

                if (data.success) {
                    currentDiffPage = page;
                    const tbody = document.querySelector('#priceDiffTable tbody');
                    tbody.innerHTML = '';

                    data.data.forEach((item, index) => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td><span class="rank">${offset + index + 1}</span></td>
                            <td>${item.title || '-'}</td>
                            <td>${item.isbn || '-'}</td>
                            <td class="price">Â¥${item.kongfuzi_price || 0}</td>
                            <td class="price">Â¥${item.duozhuayu_price || 0}</td>
                            <td class="profit">Â¥${item.price_diff || 0}</td>
                            <td class="profit">${item.profit_rate || 0}%</td>
                        `;
                    });

                    if (data.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">æš‚æ— æ•°æ®</td></tr>';
                    }

                    // æ›´æ–°åˆ†é¡µä¿¡æ¯
                    document.getElementById('diffPageInfo').textContent = `ç¬¬ ${page} é¡µ`;
                    document.getElementById('diffPrevBtn').disabled = page === 1;
                    document.getElementById('diffNextBtn').disabled = data.data.length < pageSize;
                }
            } catch (error) {
                console.error('åŠ è½½å·®ä»·æ’è¡Œå¤±è´¥:', error);
            }
        }

        // é¢„æœŸåˆ©æ¶¦æ’è¡Œï¼ˆé”€é‡ Ã— å·®ä»·ï¼‰
        async function loadProfitRank(page = 1) {
            try {
                const offset = (page - 1) * pageSize;
                const days = currentDays === 0 ? 9999 : currentDays;
                // è¿™é‡Œéœ€è¦åç«¯æ”¯æŒï¼Œæš‚æ—¶ç”¨æ¨¡æ‹Ÿæ•°æ®
                const response = await fetch(`/api/sales/hot?days=${days}&limit=${pageSize}&offset=${offset}`);
                const data = await response.json();

                if (data.success) {
                    currentProfitPage = page;
                    const tbody = document.querySelector('#profitRankTable tbody');
                    tbody.innerHTML = '';

                    // è®¡ç®—é¢„æœŸåˆ©æ¶¦å¹¶æ’åº
                    const profitData = data.data.map(item => ({
                        ...item,
                        price_diff: Math.random() * 50 + 10, // æ¨¡æ‹Ÿå·®ä»·
                        expected_profit: item.sales_count * (Math.random() * 50 + 10)
                    })).sort((a, b) => b.expected_profit - a.expected_profit);

                    profitData.forEach((item, index) => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td><span class="rank">${offset + index + 1}</span></td>
                            <td>${item.title || '-'}</td>
                            <td>${item.isbn || '-'}</td>
                            <td>${item.sales_count}</td>
                            <td class="profit">Â¥${item.price_diff.toFixed(2)}</td>
                            <td class="profit" style="font-weight: bold;">Â¥${item.expected_profit.toFixed(2)}</td>
                        `;
                    });

                    if (profitData.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">æš‚æ— æ•°æ®</td></tr>';
                    }

                    // æ›´æ–°åˆ†é¡µä¿¡æ¯
                    document.getElementById('profitPageInfo').textContent = `ç¬¬ ${page} é¡µ`;
                    document.getElementById('profitPrevBtn').disabled = page === 1;
                    document.getElementById('profitNextBtn').disabled = data.data.length < pageSize;
                }
            } catch (error) {
                console.error('åŠ è½½åˆ©æ¶¦æ’è¡Œå¤±è´¥:', error);
            }
        }

        async function searchBooks() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            try {
                const response = await fetch(`/api/book/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data.success) {
                    console.log('æœç´¢ç»“æœ:', data.data);
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æœç´¢ç»“æœçš„æ˜¾ç¤ºé€»è¾‘
                }
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
            }
        }

        // æ ‡ç­¾åˆ‡æ¢
        function switchTab(btn, tabName) {
            // åˆ‡æ¢æ ‡ç­¾æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');

            // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            // é‡ç½®é¡µç å¹¶åŠ è½½å¯¹åº”æ•°æ®
            switch(tabName) {
                case 'salesRank':
                    currentSalesPage = 1;
                    loadSalesRank(1);
                    break;
                case 'priceDiffRank':
                    currentDiffPage = 1;
                    loadPriceDiffRank(1);
                    break;
                case 'profitRank':
                    currentProfitPage = 1;
                    loadProfitRank(1);
                    break;
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            lucide.createIcons();
            loadDashboardData();
            loadSalesRank(1);  // é»˜è®¤åŠ è½½é”€é‡æ’è¡Œ
        };
    </script>
</body>
</html>